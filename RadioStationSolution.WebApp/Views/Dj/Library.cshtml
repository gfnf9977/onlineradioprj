@model IEnumerable<OnlineRadioStation.Domain.Track>

@{
    ViewData["Title"] = "–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ —Ç—Ä–µ–∫—ñ–≤";
}

<div class="container">
    <h1>üìö –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ —Ç—Ä–µ–∫—ñ–≤</h1>
    <p class="text-muted">–ó–∞–≥–∞–ª—å–Ω–∏–π –∞—Ä—Ö—ñ–≤ —É—Å—ñ—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤. –í–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –Ω–∞–∑–≤–∏ —Ç—É—Ç.</p>
    <hr />

    <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>–ù–∞–∑–≤–∞</th>
                <th>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</th>
                <th>HLS –ø–æ—Å–∏–ª–∞–Ω–Ω—è</th>
                <th class="text-end">–î—ñ—ó</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var track in Model)
            {
                <tr>
                    <td class="fw-bold">@track.Title</td>
                    <td>@track.Duration.ToString(@"mm\:ss")</td>
                    <td>
                        <small class="text-muted">@track.HlsUrl</small>
                    </td>
                    <td class="text-end">
                        @* –ö–Ω–æ–ø–∫–∞ –≤–∏–∫–ª–∏–∫—É –º–æ–¥–∞–ª–∫–∏ *@
                        @* –ú–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ ID —ñ –ù–∞–∑–≤—É –≤ data-–∞—Ç—Ä–∏–±—É—Ç–∞—Ö, —â–æ–± JS —ó—Ö –ø—ñ–¥—Ö–æ–ø–∏–≤ *@
                        <button type="button" 
                                class="btn btn-sm btn-outline-primary" 
                                data-bs-toggle="modal" 
                                data-bs-target="#editTrackModal"
                                data-track-id="@track.TrackId"
                                data-track-title="@track.Title">
                            <i class="bi bi-pencil"></i> –†–µ–¥.
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@* ========================================== *@
@* === –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø === *@
@* ========================================== *@
<div class="modal fade" id="editTrackModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–ó–º—ñ–Ω–∏—Ç–∏ –Ω–∞–∑–≤—É —Ç—Ä–µ–∫—É</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <form asp-action="EditTrackTitle" method="post">
                <div class="modal-body">
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="modalTrackId" name="trackId" />

                    <div class="mb-3">
                        <label for="newTitle" class="form-label">–ù–æ–≤–∞ –Ω–∞–∑–≤–∞:</label>
                        <input type="text" id="modalTrackTitle" name="newTitle" class="form-control" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="btn btn-primary">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>
</div>

@* === –°–ö–†–ò–ü–¢ –î–õ–Ø –ü–ï–†–ï–î–ê–ß–Ü –î–ê–ù–ò–• –£ –ú–û–î–ê–õ–ö–£ === *@
<script>
    var editModal = document.getElementById('editTrackModal');
    editModal.addEventListener('show.bs.modal', function (event) {
        // –ö–Ω–æ–ø–∫–∞, —è–∫–∞ –≤–∏–∫–ª–∏–∫–∞–ª–∞ –º–æ–¥–∞–ª–∫—É
        var button = event.relatedTarget;
        
        // –î—ñ—Å—Ç–∞—î–º–æ –¥–∞–Ω—ñ –∑ data-–∞—Ç—Ä–∏–±—É—Ç—ñ–≤
        var trackId = button.getAttribute('data-track-id');
        var trackTitle = button.getAttribute('data-track-title');
        
        // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–æ–ª—è —É –º–æ–¥–∞–ª—Ü—ñ
        var modalIdInput = editModal.querySelector('#modalTrackId');
        var modalTitleInput = editModal.querySelector('#modalTrackTitle');
        
        // –ó–∞–ø–æ–≤–Ω—é—î–º–æ —ó—Ö
        modalIdInput.value = trackId;
        modalTitleInput.value = trackTitle;
    });
</script>