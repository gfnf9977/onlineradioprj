@model IEnumerable<OnlineRadioStation.Domain.Track>

@{
    ViewData["Title"] = "–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ —Ç—Ä–µ–∫—ñ–≤";
    var queuedIds = ViewBag.QueuedTrackIds as HashSet<Guid> ?? new HashSet<Guid>();
}

<div class="container">
    <h1>üìö –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ —Ç—Ä–µ–∫—ñ–≤</h1>
    <p class="text-muted">–ó–∞–≥–∞–ª—å–Ω–∏–π –∞—Ä—Ö—ñ–≤ —É—Å—ñ—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤.</p>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <hr />

    <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th>–ù–∞–∑–≤–∞</th>
                <th>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</th>
                <th>HLS –ø–æ—Å–∏–ª–∞–Ω–Ω—è</th>
                <th class="text-end">–î—ñ—ó</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var track in Model)
            {
                <tr>
                    <td class="fw-bold">@track.Title</td>
                    <td>@track.Duration.ToString(@"mm\:ss")</td>
                    <td>
                        <small class="text-muted">@track.HlsUrl</small>
                    </td>
                    <td class="text-end">
                        <div class="btn-group">
                            @if (queuedIds.Contains(track.TrackId))
                            {
                                <button type="button" class="btn btn-sm btn-secondary" disabled title="–í–∂–µ –≤ –µ—Ñ—ñ—Ä—ñ">
                                    <i class="bi bi-check-lg"></i> –í –µ—Ñ—ñ—Ä—ñ
                                </button>
                            }
                            else
                            {
                                <form asp-action="AddToQueue" method="post" style="display:inline;">
                                    <input type="hidden" name="trackId" value="@track.TrackId" />
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-success" title="–î–æ–¥–∞—Ç–∏ –≤ –º—ñ–π –µ—Ñ—ñ—Ä">
                                        <i class="bi bi-plus-lg"></i> –î–æ–¥–∞—Ç–∏
                                    </button>
                                </form>
                            }
                            <button type="button"
                                    class="btn btn-sm btn-outline-primary ms-1"
                                    data-bs-toggle="modal"
                                    data-bs-target="#editTrackModal"
                                    data-track-id="@track.TrackId"
                                    data-track-title="@track.Title">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div class="modal fade" id="editTrackModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–ó–º—ñ–Ω–∏—Ç–∏ –Ω–∞–∑–≤—É —Ç—Ä–µ–∫—É</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <form asp-action="EditTrackTitle" method="post">
                <div class="modal-body">
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="modalTrackId" name="trackId" />

                    <div class="mb-3">
                        <label for="newTitle" class="form-label">–ù–æ–≤–∞ –Ω–∞–∑–≤–∞:</label>
                        <input type="text" id="modalTrackTitle" name="newTitle" class="form-control" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="submit" class="btn btn-primary">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    var editModal = document.getElementById('editTrackModal');
    editModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;

        var trackId = button.getAttribute('data-track-id');
        var trackTitle = button.getAttribute('data-track-title');

        var modalIdInput = editModal.querySelector('#modalTrackId');
        var modalTitleInput = editModal.querySelector('#modalTrackTitle');

        modalIdInput.value = trackId;
        modalTitleInput.value = trackTitle;
    });
</script>